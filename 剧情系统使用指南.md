# 剧情系统使用指南

## 系统概述
本剧情系统采用状态转移树设计，通过节点和分支实现复杂的剧情流程。系统支持以下功能：
- 多分支剧情选择
- 基于条件的剧情触发
- 地图位置触发剧情
- NPC交互触发剧情
- 简单的文本显示和选项选择界面

## 文件结构
- `StorySystem.h`: 定义剧情系统的核心类和接口
- `StorySystem.cpp`: 实现剧情系统的功能和初始化
- `MainShell.h`: 集成剧情系统到游戏主界面
- `main.cpp`: 初始化和启动剧情系统

## 使用方法

### 1. 初始化剧情系统
在游戏启动时，调用`InitStorySystem()`函数初始化剧情系统：
```cpp
// 在main.cpp中
InitStorySystem();
```

### 2. 启动剧情
使用`StartGameStory()`函数启动初始剧情，或使用`g_storySystem.startStory(nodeId)`启动指定节点的剧情：
```cpp
// 启动初始剧情
StartGameStory();

// 或启动指定节点的剧情
// g_storySystem.startStory(5);
```

### 3. 添加新剧情节点
在`StorySystem.cpp`的`InitStorySystem()`函数中添加新的剧情节点：
```cpp
// 创建新节点
StoryNode newNode(6, "这是一个新的剧情节点。");

// 添加选项
newNode.addChoice("选项1", 7);
newNode.addChoice("选项2", 8);

// 设置触发条件
newNode.setCondition([](const Person& player) {
    // 只有当玩家等级大于10时才触发
    return player.GetLevel() > 10;
});

// 添加到剧情系统
g_storySystem.addNode(newNode);
```

### 4. 地图触发剧情
在`MainShell.h`的`DrawPlots()`函数中，取消注释并修改地图触发条件检查：
```cpp
// 检查玩家位置是否触发剧情
if (g_storySystem.checkMapTrigger(player.GetX(), player.GetY(), player)) {
    // 剧情已触发，无需额外操作
}
```

### 5. NPC触发剧情
在与NPC交互时，调用`checkNPCTrigger()`函数检查是否触发剧情：
```cpp
// 与NPC 1对话时
if (g_storySystem.checkNPCTrigger(1, player)) {
    // 剧情已触发
}
```

## 扩展建议
1. **导入剧情数据**：可以从JSON或XML文件加载剧情数据，避免硬编码。
2. **剧情变量系统**：添加全局变量系统，用于记录剧情进展和影响后续剧情。
3. **多结局系统**：根据玩家选择和游戏状态，实现不同的结局。
4. **动画和音效**：在剧情关键点添加简单的动画和音效，增强体验。
5. **任务系统集成**：将剧情系统与任务系统集成，实现任务驱动的剧情发展。

## 注意事项
1. 确保所有剧情节点ID唯一。
2. 对于重要的剧情选择，考虑添加存档功能。
3. 复杂的剧情条件可以使用 lambda 表达式或函数对象实现。
4. 根据实际的剧情初稿，修改`StorySystem.cpp`中的剧情节点内容。