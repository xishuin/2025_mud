#include "StorySystem.h"
#include <iostream>
#include "Person_Skill_Class/Person.h"
#include "Map.h"
#include "map/map.h"

// 定义全局剧情系统
StorySystem g_storySystem;

// 初始化剧情系统
void InitStorySystem() {
    // 创建剧情节点
    // 节点0: 初始剧情
    StoryNode node0(0, "艾利克斯（担忧地）：罗汀！你的状态越来越差了。我查阅了所有古籍，只有传说中的“始源之种”才能稳定你的魔力。它位于迷雾森林深处的精灵遗迹中。你必须立刻动身！");
    node0.addChoice("1.前往迷雾森林 - 精灵遗迹", 1);
    node0.addChoice("2.蛐蛐诅咒，不足为惧，不接受建议", 2);
    g_storySystem.addNode(node0);

    // 节点1: 洞穴探险
    StoryNode node1(1, "【场景：迷雾森林 - 精灵遗迹入口】\n "
                       "你来到迷雾森林的入口，雾气缭绕，危机四伏。一位精灵游侠拦住了你的去路。\n"""
                        """【NPC：精灵游侠莉娜】（警惕地）：站住！凡人。精灵圣地不是你能随意闯入的地方。除非你能证明你的价值。""");
    node1.addChoice("1. 让开！帝国首席魔法师的事，轮不到你一个小小游侠管。", 4);
    node1.addChoice("2. 我需要进入遗迹寻找‘始源之种’来救治我的伤势，希望能得到你的帮助", 5);
    g_storySystem.addNode(node1);
    StoryNode node5(5,"莉娜对你的态度缓和。\n莉娜（点头）：“好吧，我信你。但遗迹深处很危险，我不能陪你进去。这是进入圣地的信物，拿好");
    node5.addChoice("1.前往了遗迹深处",6);
    g_storySystem.addNode(node5);
    StoryNode node6(6,
        "你在遗迹深处找到了一块巨大的水晶基座，但上面空空如也。一位年长的精灵守护者走了过来。\n"
        "\n【NPC：精灵守护者】"
        "守护者（叹息）： “始源之种”早已破碎，被分散到了大陆的四个角落。你需要集齐它们的力量，才能重塑它。”"
        "“始源之种”被分为四块碎片，分别位于：矮人王国的熔火之心、兽人部落的遗忘高地、人类帝国的皇家宝库、天空之城的圣山之巅");
    node6.addChoice("1.前往【矮人王国 - 熔火之心】",7);
    node6.addChoice("2.进行更多探索（留在原地）",-1);
    g_storySystem.addNode(node6);
    StoryNode node7(7,"【场景：矮人王国 - 熔火之心】\n"
                      "你来到矮人王国的熔火之心，这里热浪滚滚。矮人国王正为矿洞塌方而烦恼。\n"
                      "【NPC：矮人国王】: “该死的！矿洞又塌了，我的工匠们都被困在里面了！更糟糕的是，通往矿洞深处的’熔火钥匙’被一只火元素兽看守着，没有它就无法打开加固通道的机关！你要是能帮我拿到钥匙并救出他们，我就把’大地碎片’给你！\n"
                      "【玩家任务：矿洞救援】\n"
                      "1.首先前往矿洞深处，击败火元素兽，获取’熔火钥匙’\n"
                      "2.使用钥匙打开加固通道的机关\n"
                      "3.进入塌方区域，救出被困的工匠\n”"
        );
    node7.addChoice("1,skip",8);
    g_storySystem.addNode(node7);
    StoryNode node8(8,"你使用钥匙打开了机关，救出了被困的工匠\n");
    node8.addChoice("1.选择前往其他地方(你将离开矮人王国，继续你的冒险之旅，带着新获得的大地碎片前往下一个未知区域)",9);
    node8.addChoice("2.与救出的工匠们交谈",9);
    g_storySystem.addNode(node8);
    StoryNode node9(9,"【场景：兽人部落 - 遗忘高地】\n"
                      "你来到兽人部落的遗忘高地，这里充满了原始的狂野气息。兽人战士们个个肌肉虬结，眼神中透露着对入侵者的警惕，但肚子却咕咕作响。");
    node9.addChoice("1.饥饿的兽人不足为惧，直接抢",10);
    node9.addChoice("2.与兽人们做交易，用食物换取生命碎片",10);
    node9.addChoice("3.与酋长交流，询问情况",10);
    g_storySystem.addNode(node9);
    StoryNode node10(10,"【NPC：兽人酋长】\n"
                        "酋长（低吼）： “我们的猎场被怪物占据了，大家都要饿死了!如果你能夺回猎场，我就把‘生命碎片’给你。\n”"
                        );
    node10.addChoice("1:skip",11);
    g_storySystem.addNode(node10);
    StoryNode node11(11,"酋长（敬佩地）：兽人向来尊敬强者，我的朋友，这是你需要的’生命碎片’。\n"""
                        "酋长将一块散发着柔和绿光的晶体递到你手中，那光芒仿		佛有生命般在掌心轻轻脉动。\n"
                        "【系统提示】:你接过碎片，感受到一股温暖的力量顺着指尖蔓延至全身。这力量并不猛烈，却如涓涓细流，滋养着你疲惫的身躯。\n"
                        "酋长（咧嘴一笑，露出两颗略微发亮的獠牙）:“兽人从不亏待真正的勇士。你的勇气和智慧已经赢得了我们的尊重。\n"
                        "这片森林是我们的家园，也是你的朋友。无论何时需要，这里永远有你的位置。");
    node11.addChoice("1.即刻前往【人类帝国 - 皇家宝库】",12);
    node11.addChoice("2.我也许需要休整一下",12);
    g_storySystem.addNode(node11);
    StoryNode node12(12,"【场景：人类帝国 - 帝都】\n"
                        "你回到了帝都，这个曾经熟悉的地方。你准备进城，却遭到了卫兵的盘查。\n"
                        """站住！出示你的通行令牌""""为首的卫兵队长拦住了你的去路，眼神锐利地打量着你。");
    node12.addChoice("1.我是帝国的首席魔法师（亮出自己的令牌），这是我的令牌。",13);
    node12.addChoice("2.""我是帝国的首席魔法师 ,你试图用曾经的威严震慑对方，“奉陛下密令返回，让开！”",30);
    g_storySystem.addNode(node12);
    StoryNode node13(13,"【NPC：守门卫兵】:（惊恐的）首席…首席大人恕罪！属下有眼不识泰山，请大人恕罪！"
                        "\n“【系统提示】:繁华如织，车水马龙，魔法光芒照亮夜空，商贾云集，人声鼎沸，这位远来的客人，您似乎对眼前的光景并不惊讶”"
                        "\n 你循声看去，说话的是一名金发飘逸，蓝眸灵动，身着华丽丝绒长袍，腰间挂着鲁特琴，举手投足间有着贵族气质与吟游诗人般衣着的青年男子。"
                        "\n【NPC：吟游诗人丹德里恩】:“也许您曾经到过帝都，但帝都这些年可大变样了，那么，我是说，您是否需要一名导游呢，我的朋友。” ");
    node13.addChoice("1.（支付《《货币或道具》》，聘请他）",31);
    node13.addChoice("2.不理会他，转身就走",14);
    g_storySystem.addNode(node13);
    StoryNode node14(14,"【系统提示】:望着偌大的帝都，你一时竟不知先去哪");
    node14.addChoice("1.前往【皇家金库】",15);
    node14.addChoice("》2.前往【帝都魔法学院】",32);
    g_storySystem.addNode(node14);
    StoryNode node15(15,"【场景：皇家金库】\n"
                        "你来到了一座高耸入云的建筑前，这里人来人往的尽是些衣着华丽的人，你走上前去，在威严的守卫注视下，出示了你的首席魔法师令牌。\n"
                        "守卫立刻恭敬地行礼，为你打开了通往金库深处的道路。\n"
                        "接下来的事情竟然出奇的顺利，似乎是因为人们对于火焰碎片并不了解，你在支付了《《货币或道具》》后竟然直接得到了它");
    node15.addChoice("1.前往【天空之城-圣山之巅】",16);
    g_storySystem.addNode(node15);
    StoryNode node16(16,"【场景：天空之城 - 圣山之巅】\n"
                        "你来到天空之城，在圣山之巅，你看到了曾经被你击败的翼人族族长。\n"
                        "【NPC：翼人族族长】:（平静地）： “我一直在等你。我知道‘风之碎片’在哪里。它不在我们这里，而在守\n"
                        "护它的‘天空守护者’体内。击败它，你就能得到碎片");
    node16.addChoice("1.skip",17);
    g_storySystem.addNode(node16);
    StoryNode node17(17,"【系统提示】:得到了”风之碎片”\n"
                        "【NPC：翼人族族长】:你在战斗中似乎没有以前那么游刃有余了（举起风之碎片），如果你想要，那就自己来拿（一阵意义不明的鼓点）");
    node17.addChoice("1.skip",18);
    g_storySystem.addNode(node17);
    StoryNode node18(18,"【系统提示】:恭喜您获得了道具”风之碎片”\n"
                        "你即刻启程，朝着精灵遗迹出发\n");
    node18.addChoice("1.skip",19);
    g_storySystem.addNode(node18);
    StoryNode node19(19,"【场景：精灵遗迹 - 中央大厅（最终）】\n"
                        "你集齐了四块碎片，回到精灵遗迹。将它们放入水晶基座，光芒大盛，“始源之种”被重塑。\n"
                        "你感受到一股温暖的力量涌入体内，诅咒被解除了。但你的魔力并没有回到巅峰，而是以一种更稳定、更可控的形式存在。\n"
                        "【NPC：精灵守护者】:“孩子，你找到了。但这并非结束。你失去的，是傲慢；得到的，是智慧。那么，在这之后，你的安排是什么呢？。”\n"
                        "");
    node19.addChoice("1.“我要回到帝国，重新夺回我的一切！”",20);
    node19.addChoice("2.也许是去兽人部落那帮忙狩猎，也许去矮人那当个工匠，当然，也许留在这。我不确定，也许我应该继续我的旅途，什么时候走不动了，就随处安顿下来吧。我想我再想要当首席魔法师了。",21);
    g_storySystem.addNode(node19);
    StoryNode node20(20,"【系统提示】:在回帝都的路上，你遭遇了埋伏\n"
                        "你回到了帝都，虽然力量恢复，但你的傲慢本性未改，最终众叛亲离，	在孤独和权力的追逐中迷失了自己。",1);
    StoryNode node21(21,"你没有做出选择，但你做出了最好的选择\n"
                        "恭喜您完成了最终成就【没有选择的余生】",1);
    g_storySystem.addNode(node20);
    g_storySystem.addNode(node21);
    std::cout << "剧情系统初始化完成！" << std::endl;
}

// 处理剧情选择事件
void handleChoiceEvent(int nodeId, int choiceId) {

}

// 在main函数中调用此函数来初始化剧情系统
// 可以在游戏开始时或需要的时候触发特定剧情
void StartGameStory() {
    g_storySystem.startStory(0);
}